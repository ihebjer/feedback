<script>
  const params = new URLSearchParams(window.location.search);
  const dietEncoded = params.get("diet");
  const sessionId = params.get("sessionId");

  if (dietEncoded) {
    try {
      // Base64 decode then URI decode
      const decoded = decodeURIComponent(atob(dietEncoded));

      // Parse the string into a JSON object
      const dietObj = JSON.parse(decoded);

      // Display the parsed and formatted JSON in the <pre>
      document.getElementById("diet-box").textContent = JSON.stringify(dietObj, null, 2);

      // Store the original JSON string (for submission)
      document.getElementById("dietField").value = decoded;
    } catch (e) {
      document.getElementById("diet-box").textContent = "‚ùå Failed to parse diet JSON.";
      console.error("Error parsing diet:", e);
    }
  }

  if (sessionId) {
    document.getElementById("sessionIdField").value = sessionId;
  }
</script>
